# =============================================================================
# Reusable Workflow: Mega-Linter
# =============================================================================
# Call this workflow from your main CI pipeline:
#
#   lint:
#     uses: ./.github/workflows/reusable-lint.yml
#     with:
#       validate-all: false
#
# =============================================================================

name: "Reusable: Lint"

on:
  workflow_call:
    inputs:
      validate-all:
        description: 'Validate entire codebase (not just changed files)'
        required: false
        default: false
        type: boolean
      config-file:
        description: 'Path to Mega-Linter config file'
        required: false
        default: '.mega-linter.yml'
        type: string
      fail-on-errors:
        description: 'Fail the workflow on linting errors'
        required: false
        default: true
        type: boolean
    outputs:
      status:
        description: 'Linting status (success/failure)'
        value: ${{ jobs.lint.outputs.status }}

jobs:
  lint:
    name: Mega-Linter
    runs-on: ubuntu-latest
    timeout-minutes: 15
    outputs:
      status: ${{ steps.ml.outcome }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Mega-Linter
        id: ml
        uses: oxsecurity/megalinter@v8
        env:
          VALIDATE_ALL_CODEBASE: ${{ inputs.validate-all }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          MEGALINTER_CONFIG: ${{ inputs.config-file }}
          DISABLE_ERRORS: ${{ !inputs.fail-on-errors }}

      - name: Upload Mega-Linter reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: megalinter-reports
          path: |
            megalinter-reports/
            mega-linter.log
          retention-days: 30
          if-no-files-found: ignore
